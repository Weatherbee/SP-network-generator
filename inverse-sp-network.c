#include <stdint.h>

void inverse_sp_network (uint8_t A[3], uint8_t Y[3])
{
  /* S-box contents */
  const uint8_t SBOX00[ 64] = { 55, 22, 47, 11, 44, 45, 27, 63,
                                57, 62, 14, 59,  8, 41, 51, 36,
                                 7,  6, 20, 39,  1, 46, 54, 32,
                                 2, 61, 43, 29,  9, 30, 12, 53,
                                35, 34, 18, 28, 58, 25,  0,  4,
                                40,  3, 48, 10, 16, 19, 15, 23,
                                38,  5, 21, 33, 49, 24, 31, 52,
                                42, 13, 50, 56, 17, 60, 37, 26 };
  const uint8_t SBOX01[ 32] = {  2,  1, 15, 14, 16, 26, 25, 22,
                                 0,  3, 28,  7, 21,  6, 20, 24,
                                31,  5, 27, 18,  8, 11, 10, 30,
                                23, 29,  9, 19,  4, 17, 13, 12 };
  const uint8_t SBOX02[ 64] = { 55, 19, 52,  9, 56,  2,  8,  0,
                                26, 59, 45,  4, 35, 16, 62, 11,
                                38, 42, 15, 40, 20, 29, 25, 10,
                                37, 18, 51, 61, 34, 53, 60, 44,
                                39, 24, 36, 27, 31, 28, 22, 50,
                                47, 21, 33, 14,  7,  3, 23, 58,
                                 1, 32, 41, 49, 43,  6, 30, 57,
                                13, 46, 48, 12, 63, 17,  5, 54 };
  const uint8_t SBOX03[  2] = {  1,  0 };

  /* Define Substitution-Permutation Network */
  uint8_t SBOX00_A = ((A[1]&0x80)>>7)|
                     ((A[2]&0x02))|
                     ((A[0]&0x02)<<1)|
                     ((A[0]&0x08))|
                     ((A[0]&0x01)<<4)|
                     ((A[0]&0x04)<<3);
  uint8_t SBOX00_Y = SBOX00[SBOX00_A & 0x3F];
  Y[0] = (Y[0]&0x7F)|((SBOX00_Y&0x01)<<7);
  Y[1] = (Y[1]&0x7F)|((SBOX00_Y&0x02)<<6);
  Y[2] = (Y[2]&0xFD)|((SBOX00_Y&0x04)>>1);
  Y[1] = (Y[1]&0xFD)|((SBOX00_Y&0x08)>>2);
  Y[0] = (Y[0]&0xDF)|((SBOX00_Y&0x10)<<1);
  Y[2] = (Y[2]&0xFE)|((SBOX00_Y&0x20)>>5);

  uint8_t SBOX01_A = ((A[1]&0x40)>>6)|
                     ((A[0]&0x40)>>5)|
                     ((A[1]&0x20)>>3)|
                     ((A[2]&0x01)<<3)|
                     ((A[0]&0x80)>>3);
  uint8_t SBOX01_Y = SBOX01[SBOX01_A & 0x1F];
  Y[0] = (Y[0]&0xFE)|((SBOX01_Y&0x01));
  Y[0] = (Y[0]&0xFB)|((SBOX01_Y&0x02)<<1);
  Y[0] = (Y[0]&0xEF)|((SBOX01_Y&0x04)<<2);
  Y[0] = (Y[0]&0xBF)|((SBOX01_Y&0x08)<<3);
  Y[1] = (Y[1]&0xFE)|((SBOX01_Y&0x10)>>4);

  uint8_t SBOX02_A = ((A[1]&0x08)>>3)|
                     ((A[1]&0x04)>>1)|
                     ((A[0]&0x10)>>2)|
                     ((A[1]&0x02)<<2)|
                     ((A[1]&0x01)<<4)|
                     ((A[0]&0x20));
  uint8_t SBOX02_Y = SBOX02[SBOX02_A & 0x3F];
  Y[1] = (Y[1]&0xFB)|((SBOX02_Y&0x01)<<2);
  Y[0] = (Y[0]&0xFD)|((SBOX02_Y&0x02));
  Y[1] = (Y[1]&0xBF)|((SBOX02_Y&0x04)<<4);
  Y[0] = (Y[0]&0xF7)|((SBOX02_Y&0x08));
  Y[1] = (Y[1]&0xEF)|((SBOX02_Y&0x10));
  Y[1] = (Y[1]&0xF7)|((SBOX02_Y&0x20)>>2);

  uint8_t SBOX03_A = ((A[1]&0x10)>>4);
  uint8_t SBOX03_Y = SBOX03[SBOX03_A & 0x1];
  Y[1] = (Y[1]&0xDF)|((SBOX03_Y&0x01)<<5);

}
