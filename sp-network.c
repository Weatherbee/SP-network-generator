#include <stdint.h>

void sp_network (uint8_t A[3], uint8_t Y[3])
{
  /* S-box contents */
  const uint8_t SBOX00[ 64] = { 38, 20, 24, 41, 39, 49, 17, 16,
                                12, 28, 43,  3, 30, 57, 10, 46,
                                44, 60, 34, 45, 18, 50,  1, 47,
                                53, 37, 63,  6, 35, 27, 29, 54,
                                23, 51, 33, 32, 15, 62, 48, 19,
                                40, 13, 56, 26,  4,  5, 21,  2,
                                42, 52, 58, 14, 55, 31, 22,  0,
                                59,  8, 36, 11, 61, 25,  9,  7 };
  const uint8_t SBOX01[ 32] = {  8,  1,  0,  9, 28, 17, 13, 11,
                                20, 26, 22, 21, 31, 30,  3,  2,
                                 4, 29, 19, 27, 14, 12,  7, 24,
                                15,  6,  5, 18, 10, 25, 23, 16 };
  const uint8_t SBOX02[ 64] = {  7, 48,  5, 45, 11, 62, 53, 44,
                                 6,  3, 23, 15, 59, 56, 43, 18,
                                13, 61, 25,  1, 20, 41, 38, 46,
                                33, 22,  8, 35, 37, 21, 54, 36,
                                49, 42, 28, 12, 34, 24, 16, 32,
                                19, 50, 17, 52, 31, 10, 57, 40,
                                58, 51, 39, 26,  2, 29, 63,  0,
                                 4, 55, 47,  9, 30, 27, 14, 60 };
  const uint8_t SBOX03[  2] = {  1,  0 };

  /* Define Substitution-Permutation Network */
  uint8_t SBOX00_A = ((A[0]&0x80)>>7)|
                     ((A[1]&0x80)>>6)|
                     ((A[2]&0x02)<<1)|
                     ((A[1]&0x02)<<2)|
                     ((A[0]&0x20)>>1)|
                     ((A[2]&0x01)<<5);
  uint8_t SBOX00_Y = SBOX00[SBOX00_A & 0x3F];
  Y[1] = (Y[1]&0x7F)|((SBOX00_Y&0x01)<<7);
  Y[2] = (Y[2]&0xFD)|((SBOX00_Y&0x02));
  Y[0] = (Y[0]&0xFD)|((SBOX00_Y&0x04)>>1);
  Y[0] = (Y[0]&0xF7)|((SBOX00_Y&0x08));
  Y[0] = (Y[0]&0xFE)|((SBOX00_Y&0x10)>>4);
  Y[0] = (Y[0]&0xFB)|((SBOX00_Y&0x20)>>3);

  uint8_t SBOX01_A = ((A[0]&0x01))|
                     ((A[0]&0x04)>>1)|
                     ((A[0]&0x10)>>2)|
                     ((A[0]&0x40)>>3)|
                     ((A[1]&0x01)<<4);
  uint8_t SBOX01_Y = SBOX01[SBOX01_A & 0x1F];
  Y[1] = (Y[1]&0xBF)|((SBOX01_Y&0x01)<<6);
  Y[0] = (Y[0]&0xBF)|((SBOX01_Y&0x02)<<5);
  Y[1] = (Y[1]&0xDF)|((SBOX01_Y&0x04)<<3);
  Y[2] = (Y[2]&0xFE)|((SBOX01_Y&0x08)>>3);
  Y[0] = (Y[0]&0x7F)|((SBOX01_Y&0x10)<<3);

  uint8_t SBOX02_A = ((A[1]&0x04)>>2)|
                     ((A[0]&0x02))|
                     ((A[1]&0x40)>>4)|
                     ((A[0]&0x08))|
                     ((A[1]&0x10))|
                     ((A[1]&0x08)<<2);
  uint8_t SBOX02_Y = SBOX02[SBOX02_A & 0x3F];
  Y[1] = (Y[1]&0xF7)|((SBOX02_Y&0x01)<<3);
  Y[1] = (Y[1]&0xFB)|((SBOX02_Y&0x02)<<1);
  Y[0] = (Y[0]&0xEF)|((SBOX02_Y&0x04)<<2);
  Y[1] = (Y[1]&0xFD)|((SBOX02_Y&0x08)>>2);
  Y[1] = (Y[1]&0xFE)|((SBOX02_Y&0x10)>>4);
  Y[0] = (Y[0]&0xDF)|((SBOX02_Y&0x20));

  uint8_t SBOX03_A = ((A[1]&0x20)>>5);
  uint8_t SBOX03_Y = SBOX03[SBOX03_A & 0x1];
  Y[1] = (Y[1]&0xEF)|((SBOX03_Y&0x01)<<4);

}
